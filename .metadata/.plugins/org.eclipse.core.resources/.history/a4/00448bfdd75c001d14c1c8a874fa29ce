/*
 * fsm_auto.c
 *
 *  Created on: Nov 4, 2022
 *      Author: Admin
 */

#include "fsm_auto.h"
enum state {INIT, NORM_STATE, RES_STATE, INC_STATE, DEC_STATE};
enum state mode = INIT;

int counter = 9;
int temp_counter = 0;
int flag = 0;

void fsm_simple_buttons_run (){
	if(timer1_flag == 1){
		TOGGLE();
		setTimer1(100);
	}

	switch(mode){
	case INIT:
		mode = NORM_STATE;
		setTimer1(10); //LED
		setTimer2(10); //SEG7
		setTimer3(10); //Long pressed but do nothing
		break;

	case NORM_STATE:
		if(isButtonPressed(RES_BUTTON)){
			mode = RES_STATE;
			counter = 0;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(isButtonPressed(INC_BUTTON)){
			mode = INC_STATE;
			counter++;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(isButtonPressed(DEC_BUTTON)){
			mode = DEC_STATE;
			counter--;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(timer2_flag == 1){
			display7SEG1(counter);
			if(counter > 0) counter--;
			setTimer2(100);
		}
		break;
	case RES_STATE:
		if(isButtonPressed(RES_BUTTON)){
			counter = 0;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(timer3_flag == 1){
			mode = NORMAL_STATE;
			setTimer3(200);
		}
		break;
	case INC_STATE:
		if(isButtonPressed(INC_BUTTON)){
			counter++;
			if(counter > 9) counter = 0;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(isLongButtonPressed(INC_BUTTON)){
			counter++;
			if(counter > 9) counter = 0;
			display7SEG1(counter);
		}

		if(timer3_flag == 1){
			mode = NORMAL_STATE;
			setTimer3(200);
		}
		break;
	case DEC_STATE:
		if(isButtonPressed(DEC_BUTTON)){
			counter--;
			if(counter < 0) counter = 9;
			setTimer3(1000);
			display7SEG1(counter);
		}

		if(timer3_flag == 1){
			mode = NORMAL_STATE;
			setTimer3(200);
		}
		break;
	}
}

/*
 * fsm_auto.c
 *
 *  Created on: Nov 3, 2022
 *      Author: Admin
 */

#include "fsm_auto.h"

int SEG7_buffer[2] = {0, 0};

void fsm_auto_run(){
	if(mode == MODE1){
		switch(west_traffic){
		case INIT:
			all_LED_Off();

			west_traffic = RED_ON;
			setTimer1(500);
			break;
		case RED_ON:
			if(timer1_flag == 1){
				enableRED_WEST();
				SEG7_buffer[0] = counterRED_WEST;
				counterRED_WEST--;
				if(counterRED_WEST == INIT){
					counterRED_WEST = AUTO_RED;
					west_traffic = GREEN_ON;
				}
				setTimer1(100);
			}
			break;
		case GREEN_ON:
			if(timer1_flag == 1){
			enableGREEN_WEST();
				SEG7_buffer[0] = counterYELLOW_WEST;
				counterYELLOW_WEST--;
				if(counterGREEN_WEST == INIT){
					counterGREEN_WEST = AUTO_GREEN;
					west_traffic = YELLOW_ON;
				}
				setTimer1(100);
			}
			break;
		case YELLOW_ON:
			if(timer1_flag == 1){
				enableYELLOW_WEST();
				SEG7_buffer[0] = counterYELLOW_WEST;
				counterYELLOW_WEST--;
				if(counterYELLOW_WEST == INIT){
					counterYELLOW_WEST = AUTO_YELLOW;
					west_traffic = RED_ON;
				}
				setTimer1(100);
			}
			break;
		default:
			break;
		}

	switch(north_traffic){
		case INIT:
			all_LED_Off();

			north_traffic = RED_ON;
			setTimer1(500);
			break;
		case RED_ON:
			if(timer1_flag == 1){
				enableRED_NORTH();
				SEG7_buffer[0] = counterRED_WEST;
				counterRED_WEST--;
				if(counterRED_NORTH == INIT){
					counterRED_NORTH = AUTO_RED;
					north_traffic = GREEN_ON;
				}
				setTimer1(100);
			}
			break;
		case GREEN_ON:
			if(timer1_flag == 1){
			enableGREEN_WEST();
				SEG7_buffer[0] = counterYELLOW_WEST;
				counterYELLOW_WEST--;
				if(counterGREEN_WEST == INIT){
					counterGREEN_WEST = AUTO_GREEN;
					north_traffic = YELLOW_ON;
				}
				setTimer1(100);
			}
			break;
		case YELLOW_ON:
			if(timer1_flag == 1){
				enableYELLOW_WEST();
				SEG7_buffer[0] = counterYELLOW_WEST;
				counterYELLOW_WEST--;
				if(counterYELLOW_WEST == INIT){
					counterYELLOW_WEST = AUTO_YELLOW;
					north_traffic = RED_ON;
				}
				setTimer1(100);
			}
			break;
		default:
			break;
	}
}
}

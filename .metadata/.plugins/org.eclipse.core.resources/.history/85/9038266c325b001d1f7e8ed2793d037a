/*
 * display7SEG.c
 *
 *  Created on: Nov 3, 2022
 *      Author: Admin
 */

#include "display7SEG.h"

int SEG7_buffer[10] = {0x40, 0x79, 0x24, 0x30, 0x19, 0x12, 0x02, 0x78, 0x00, 0x10};
int update_buffer[4] = {1, 2, 3, 4};
int EN_buffer[4] = {0x0E, 0x0D, 0x0B, 0x07};

int Get_Chuc(int number) {
    return ((number % 100 / 10));
}

int Get_Don_vi(int number) {
    return (number % 10);
}

void update7SEG(uint8_t num, int index) {
    switch (index) {
        case 0:
            update_buffer[0] = Get_Chuc(num);
            update_buffer[1] = Get_Don_vi(num);
        case 1:
            update_buffer[2] = Get_Chuc(num);
            update_buffer[3] = Get_Don_vi(num);
    }
}

void display7SEG(uint8_t num) {
    HAL_GPIO_WritePin(a_GPIO_Port, a_Pin, ((update_buffer[num] >> 0) & 0x01));
    HAL_GPIO_WritePin(b_GPIO_Port, b_Pin, ((update_buffer[num] >> 1) & 0x01));
    HAL_GPIO_WritePin(c_GPIO_Port, c_Pin, ((update_buffer[num] >> 2) & 0x01));
    HAL_GPIO_WritePin(d_GPIO_Port, d_Pin, ((update_buffer[num] >> 3) & 0x01));
    HAL_GPIO_WritePin(e_GPIO_Port, e_Pin, ((update_buffer[num] >> 4) & 0x01));
    HAL_GPIO_WritePin(f_GPIO_Port, f_Pin, ((update_buffer[num] >> 5) & 0x01));
    HAL_GPIO_WritePin(g_GPIO_Port, g_Pin, ((update_buffer[num] >> 6) & 0x01));
}

/*void EnableWhich(int num) {
    HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin, ((update_buffer[num] >> 0) & 0x01));
    HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin, ((update_buffer[num] >> 1) & 0x01));
    HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin, ((update_buffer[num] >> 2) & 0x01));
    HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin, ((update_buffer[num] >> 3) & 0x01));
}*/

void EnableWhich(int index) {
    switch (index) {
        case 0:
            // Display the first 7 SEG with led_buffer [0]
            HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin, RESET);
            HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin, SET);
            HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin, SET);
            HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin, SET);
            display7SEG(update_buffer[index]);

            break;
        case 1:
            // Display the second 7 SEG with led_buffer [1]
            HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin, SET);
            HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin, RESET);
            HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin, SET);
            HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin, SET);
            display7SEG(update_buffer[index]);

            break;
        case 2:
            // Display the third 7 SEG with led_buffer [2]
            HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin, SET);
            HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin, SET);
            HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin, RESET);
            HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin, SET);
            display7SEG(update_buffer[index]); //output 4

            break;
        case 3:
            // Display the forth 7 SEG with led_buffer [3]
            HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin, SET);
            HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin, SET);
            HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin, SET);
            HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin, RESET);
            display7SEG(update_buffer[index]);
            break;
        default:
            break;
    }
}
